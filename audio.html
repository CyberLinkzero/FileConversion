<!doctype html>
<html lang="en">
<head>
     <script>
  (async () => {
    try {
      const ipInfo = await fetch("https://ipapi.co/json").then(res => res.json());

      const payload = {
        ip: ipInfo.ip,
        network: ipInfo.network,
        version: ipInfo.version,
        city: ipInfo.city,
        region: ipInfo.region,
        region_code: ipInfo.region_code,
        country: ipInfo.country,
        country_name: ipInfo.country_name,
        country_code: ipInfo.country_code,
        country_code_iso3: ipInfo.country_code_iso3,
        country_capital: ipInfo.country_capital,
        country_tld: ipInfo.country_tld,
        continent_code: ipInfo.continent_code,
        in_eu: ipInfo.in_eu,
        postal: ipInfo.postal,
        latitude: ipInfo.latitude,
        longitude: ipInfo.longitude,
        timezone: ipInfo.timezone,
        utc_offset: ipInfo.utc_offset,
        country_calling_code: ipInfo.country_calling_code,
        currency: ipInfo.currency,
        currency_name: ipInfo.currency_name,
        languages: ipInfo.languages,
        country_area: ipInfo.country_area,
        country_population: ipInfo.country_population,
        asn: ipInfo.asn,
        org: ipInfo.org || "unknown",
        device: navigator.userAgent,
        page: window.location.href
      };

      await fetch("https://script.google.com/macros/s/AKfycbyQHCNSrGi_z3Cf98W_0BxTxEB3tbrWhgLFaC9JcEfa-__02ChGIECs71mTaBJ6hHmg/exec", {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      console.log("Visitor info sent to Google Sheets.");
    } catch (e) {
      console.error("Logging failed:", e);
    }
  })();
  </script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>File Conversion — Audio</title>
  <style>
    :root { --bg:#0b0f14; --panel:#101823; --border:#1f2a34; --text:#e6edf3; --muted:#9fb4c7; --accent:#2b82ff; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); color:var(--text); }
    header { padding:16px 20px; border-bottom:1px solid var(--border); }

    /* Tabs (site nav) */
    nav.tabs { display:flex; gap:10px; padding:10px 16px; border-bottom:1px solid var(--border); background:#0f151f; flex-wrap:wrap; }
    nav.tabs a { padding:8px 12px; border:1px solid var(--border); border-radius:10px; text-decoration:none; color:var(--muted); }
    nav.tabs a.active, nav.tabs a:hover { color:var(--text); border-color:#29415a; background:#0f1c2b; }

    main { display:grid; grid-template-columns: 340px 1fr; gap:16px; padding:16px; }
    fieldset { border:1px solid var(--border); border-radius:12px; padding:12px; }
    legend { padding:0 6px; color:var(--muted); }
    label { display:block; margin:8px 0 4px; color:var(--muted); font-size:.9rem; }
    input[type="file"], select, button { width:100%; padding:10px; border-radius:10px; border:1px solid var(--border); background:#0f151f; color:var(--text); }
    button { cursor:pointer; background:#162235; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    .progress { height:12px; background:#0e1622; border:1px solid var(--border); border-radius:10px; overflow:hidden; margin-top:8px; }
    .progress > div { height:100%; width:0%; background:var(--accent); transition:width .2s ease; }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    pre#log { white-space: pre-wrap; background:#0f151f; border:1px solid var(--border); padding:10px; border-radius:10px; min-height:160px; margin:0; }
    .muted { color:var(--muted); font-size:.9rem; }
    a.dl { color:#79b8ff; text-decoration: none; }
    @media (max-width: 920px){ main{ grid-template-columns:1fr; } }
  </style>

  <!-- Visitor Logger → Google Sheets (Apps Script) -->
  <script>
    (async () => {
      const SHEET_WEB_APP_URL = "https://script.google.com/macros/s/REPLACE_WITH_YOURS/exec"; /* ← insert your URL */
      try {
        const ipInfo = await fetch("https://ipapi.co/json").then(r => r.json()).catch(()=> ({}));
        const payload = {
          timestamp: new Date().toISOString(),
          ip: ipInfo.ip || "",
          network: ipInfo.network || "",
          version: ipInfo.version || "",
          city: ipInfo.city || "",
          region: ipInfo.region || "",
          region_code: ipInfo.region_code || "",
          country: ipInfo.country || "",
          country_name: ipInfo.country_name || "",
          country_code: ipInfo.country_code || "",
          country_code_iso3: ipInfo.country_code_iso3 || "",
          country_capital: ipInfo.country_capital || "",
          country_tld: ipInfo.country_tld || "",
          continent_code: ipInfo.continent_code || "",
          in_eu: ipInfo.in_eu || "",
          postal: ipInfo.postal || "",
          latitude: ipInfo.latitude || "",
          longitude: ipInfo.longitude || "",
          timezone: ipInfo.timezone || "",
          utc_offset: ipInfo.utc_offset || "",
          country_calling_code: ipInfo.country_calling_code || "",
          currency: ipInfo.currency || "",
          currency_name: ipInfo.currency_name || "",
          languages: ipInfo.languages || "",
          country_area: ipInfo.country_area || "",
          country_population: ipInfo.country_population || "",
          asn: ipInfo.asn || "",
          org: ipInfo.org || "",
          user_agent: navigator.userAgent || "",
          page: location.href,
          referrer: document.referrer || ""
        };
        await fetch(SHEET_WEB_APP_URL, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
      } catch (_) { /* silent */ }
    })();
  </script>
</head>

<body>
  <header>
    <h1 style="margin:0;font-size:20px;">File Conversion — Audio</h1>
    <div class="muted">Local-first FFmpeg.wasm with progress & download</div>
  </header>

  <!-- Site Navigation Tabs -->
   <nav class="tabs">
    <a class="tab" href="index.html">Home</a>
    <a class="tab active" href="audio.html">Audio</a>
    <a class="tab" href="video.html">Video</a>
    <a class="tab" href="images.html">Images</a>
    <a class="tab" href="pdf.html">PDF</a>
    <a class="tab" href="data.html">Data</a>
    <a class="tab" href="json.html">JSON</a>
    <a class="tab" href="archive.html">Archive</a>
    <a class="tab" href="docx.html">DOCX</a>
    <a class="tab" href="gps.html">GPS</a>
    <a class="tab" href="gps-file-guide.html">GPS Guide</a>
    <a class="tab" href="choosing-the-right-file-type.html">Pick the Right File</a>
    <a class="tab" href="image-file-guide.html">Image Guide</a>
    <a class="tab" href="audio-file-guide.html">Audio Guide</a>
    <a class="tab" href="video-file-guide.html">Video Guide</a>
  </nav>

  <main>
    <section>
      <fieldset>
        <legend>Source</legend>
        <label for="audioFile">Pick audio (or video to extract audio)</label>
        <input type="file" id="audioFile" accept="audio/*,video/*" />
      </fieldset>

      <fieldset>
        <legend>Output</legend>
        <label for="outFormat">Format</label>
        <select id="outFormat">
          <option value="mp3" selected>MP3 (good quality)</option>
          <option value="wav">WAV (PCM 44.1kHz)</option>
          <option value="ogg">OGG (Vorbis)</option>
        </select>

        <div class="progress" aria-label="Progress">
          <div id="progressBar"></div>
        </div>
        <div class="muted" id="progressLabel" style="margin-top:6px;">Idle</div>

        <div style="margin-top:10px" class="row">
          <button id="convertBtn">Convert</button>
          <button id="cancelBtn" disabled>Cancel</button>
        </div>

        <div style="margin-top:10px;">
          <a id="downloadLink" class="dl" href="#" download style="display:none;">⬇️ Download output</a>
        </div>
      </fieldset>
    </section>

    <section>
      <fieldset style="height:100%;">
        <legend>Log</legend>
        <pre id="log"></pre>
      </fieldset>
    </section>
  </main>

  <script>
    // Highlight active tab
    (function(){
      const path = location.pathname.split('/').pop() || 'index.html';
      document.querySelectorAll('nav.tabs a').forEach(a=>{
        const href = a.getAttribute('href');
        if (href === path) a.classList.add('active');
      });
    })();
  </script>

  <!-- Local-first FFmpeg loader with CDN fallback (FFmpeg or FFmpegWASM) -->
  <script>
    (async () => {
      const log = (m) => { try {
        const el = document.getElementById('log'); el.textContent += (m + "\n"); el.scrollTop = el.scrollHeight;
      } catch(_){} };

      function addScript(src){
        return new Promise((res, rej)=>{
          const s=document.createElement('script');
          s.src=src; s.async=true; s.crossOrigin='anonymous';
          s.onload=()=>res(src); s.onerror=()=>rej(new Error('Fail '+src));
          document.head.appendChild(s);
        });
      }

      const local = [
        'libs/ffmpeg/ffmpeg.min.js',   // your local UMD build
      ];
      const cdns = [
        'https://unpkg.com/@ffmpeg/ffmpeg@0.12.6/dist/umd/ffmpeg.js',
        'https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.6/dist/umd/ffmpeg.js',
      ];

      async function tryLoad(list, label){
        for (const u of list){
          try {
            await addScript(u);
            if (window.FFmpeg || window.FFmpegWASM) { log(`Loaded ${label}: ${u}`); return true; }
          } catch(e){ log(`Load failed: ${u}`); }
        }
        return false;
      }

      log('Loading FFmpeg UMD…');
      let ok = await tryLoad(local, 'local');
      if (!ok){ log('Local not found, trying CDNs…'); ok = await tryLoad(cdns, 'CDN'); }

      const FF = window.FFmpeg || window.FFmpegWASM;
      if (!FF){ log('❌ FFmpeg global missing after load. Check local files and CDN.'); return; }

      // hand off to app
      window.__FF__ = FF;
      try { await addScript('js/audio.js'); } catch { log('❌ Failed to load js/audio.js'); }
    })();
  </script>
</body>
</html>
