<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>File Converter ‚Äî Cyber Edition ¬∑ Browser Video Editor</title>
  <meta name="description" content="Free in‚Äëbrowser video editor with cuts, text overlays, audio mixing, and export to MP4/WebM. Runs locally with FFmpeg.wasm. Part of File Converter ‚Äî Cyber Edition." />
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <style>
    :root{
      --bg:#0f1117; --card:#151823; --muted:#a0a6b8; --text:#e9ecf1; --brand:#7dd3fc; --accent:#a78bfa;
      --radius:18px;
    }
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial; background:radial-gradient(1000px 600px at 10% -10%, #1a1f2e 0%, transparent 60%),
      radial-gradient(800px 500px at 90% -20%, #121827 0%, transparent 60%), var(--bg); color:var(--text)}
    header{max-width:1100px; margin:24px auto 0; padding:0 16px}
    .title{display:flex; align-items:center; gap:12px}
    .logo{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,var(--brand),var(--accent));display:grid;place-items:center;color:#0b1220;font-weight:800;box-shadow:0 0 30px rgba(125,211,252,.6), inset 0 0 18px rgba(167,139,250,.45)}
    h1{font-size:clamp(22px,4vw,32px); margin:0}
    p.sub{color:var(--muted); margin:6px 0 0}

    main{max-width:1100px; margin:22px auto 60px; padding:0 16px; display:grid; grid-template-columns:340px 1fr; gap:16px}
    fieldset{border:1px solid #1f2433; border-radius:14px; padding:14px; background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01))}
    legend{padding:0 8px; color:var(--brand)}
    label{display:block; margin:8px 0 6px; font-size:.95rem; color:var(--muted)}
    input,select,button,textarea{width:100%; padding:10px 12px; border-radius:12px; border:1px solid #263047; background:#0e1422; color:var(--text)}
    button{cursor:pointer; background:linear-gradient(135deg,var(--brand),var(--accent)); color:#0b1220; font-weight:700}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .row>*{flex:1}
    .stack{display:grid; gap:8px}
    .muted{color:var(--muted)}
    .warn{color:#fbbf24}
    video{width:100%; max-height:60vh; background:#000; border-radius:14px}
    footer{max-width:1100px; margin:24px auto 80px; padding:0 16px; color:var(--muted)}
    .footer-nav{display:flex; flex-wrap:wrap; gap:10px; margin-top:8px}
    .footer-nav a{color:var(--brand); text-decoration:none}
  </style>
</head>
<body>
  <header>
    <div class="title">
      <div class="logo">üé¨</div>
      <div>
        <h1>Browser Video Editor</h1>
        <p class="sub">Cuts ‚Ä¢ text overlays ‚Ä¢ optional music ‚Ä¢ export to MP4/WebM ‚Äî runs locally in your browser.</p>
        <p class="sub"><a href="./" style="color:var(--brand)">‚Üê Back to File Converter</a></p>
      </div>
    </div>
  </header>

  <main>
    <section class="stack">
      <fieldset>
        <legend>1) Media</legend>
        <label>Video files (you can add multiple ‚Äì order = splice order)
          <input id="videoFiles" type="file" accept="video/*" multiple />
        </label>
        <label>Optional audio track (music / voice‚Äëover)
          <input id="audioFile" type="file" accept="audio/*" />
        </label>
        <small class="muted">Tip: select multiple clips at once. You can set per‚Äëclip in/out below.</small>
      </fieldset>

      <fieldset>
        <legend>2) Clip Cuts</legend>
        <div id="clips"></div>
        <div class="row">
          <button id="scanClips" type="button">Scan durations</button>
          <button id="addSplit" type="button">Add split marker to selected</button>
        </div>
        <small class="muted">Use seconds for in/out (e.g. 0, 3.5, 12.2). Leave blank = whole clip.</small>
      </fieldset>

      <fieldset>
        <legend>3) Text Overlays</legend>
        <div class="stack">
          <label>Text
            <input id="txt" placeholder="Your title or caption" />
          </label>
          <div class="row">
            <label>Start (s)<input id="txtStart" type="number" step="0.1" value="0"></label>
            <label>End (s)<input id="txtEnd" type="number" step="0.1" value="5"></label>
          </div>
          <div class="row">
            <label>Font size (px)<input id="txtSize" type="number" value="64"></label>
            <label>Position
              <select id="txtPos">
                <option value="center">Center</option>
                <option value="top">Top</option>
                <option value="bottom">Bottom</option>
                <option value="custom">Custom (X,Y)</option>
              </select>
            </label>
          </div>
          <div class="row" id="customXY" style="display:none">
            <label>X (px)<input id="txtX" type="number" value="40"></label>
            <label>Y (px)<input id="txtY" type="number" value="60"></label>
          </div>
          <label class="muted">Font file (optional; improves drawtext)
            <input id="fontFile" type="file" accept=".ttf,.otf,.ttc,.otc" />
          </label>
        </div>
      </fieldset>

      <fieldset>
        <legend>4) Output</legend>
        <div class="row">
          <label>Preset
            <select id="preset">
              <option value="orig">Original resolution</option>
              <option value="1920x1080">1080p (1920√ó1080)</option>
              <option value="1280x720">720p (1280√ó720)</option>
              <option value="3840x2160">4K (3840√ó2160)</option>
            </select>
          </label>
          <label>FPS
            <select id="fps">
              <option>24</option><option selected>30</option><option>60</option>
            </select>
          </label>
        </div>
        <div class="row">
          <label>Format
            <select id="format">
              <option value="mp4">MP4 (H.264/AAC)</option>
              <option value="webm">WebM (VP9/Opus)</option>
            </select>
          </label>
          <label>Audio splice
            <select id="audioMode">
              <option value="keep">Keep original (no music)</option>
              <option value="replace">Replace with music</option>
              <option value="mix">Mix with music</option>
              <option value="crossfade">Music with 1s crossfade at joins</option>
            </select>
          </label>
        </div>
        <button id="export" type="button">Export</button>
        <div id="log" style="white-space:pre-wrap;margin-top:8px;color:var(--muted)"></div>
        <small class="warn">First export loads ffmpeg.wasm. On GitHub Pages it runs single‚Äëthreaded (fine). For maximum speed, host with COOP/COEP headers.</small>
      </fieldset>
    </section>

    <section>
      <fieldset>
        <legend>Preview</legend>
        <video id="player" controls></video>
        <div class="row" style="margin-top:8px">
          <button id="preview" type="button">Preview merged cut</button>
          <button id="thumbs" type="button">Make thumbnails</button>
        </div>
        <div id="thumbRow" class="row" style="flex-wrap:wrap;margin-top:8px"></div>
      </fieldset>
    </section>
  </main>

  <footer>
    <div>¬© <span id="year"></span> File Converter ‚Äî Cyber Edition</div>
    <nav class="footer-nav">
      <a href="./">Home</a>
      <a href="privacy-policy.html">Privacy</a>
      <a href="terms.html">Terms</a>
      <a href="about.html">About</a>
      <a href="faq.html">FAQ</a>
      <a href="contact.html">Contact</a>
      <a href="tools.html">All Tools</a>
      <a href="blog/">Blog</a>
    </nav>
  </footer>

  <script type="module">
    import { createFFmpeg, fetchFile } from "https://unpkg.com/@ffmpeg/ffmpeg@0.12.8/dist/ffmpeg.min.js";

    const $ = (id)=>document.getElementById(id);
    const txtPos = $("txtPos");
    const customXY = $("customXY");
    txtPos.onchange = ()=> customXY.style.display = (txtPos.value==="custom")?"grid":"none";

    let clipList = []; // [{file, name, in, out, dur}]
    let audioBlob = null;
    let ffmpeg;

    function log(msg){ $("log").textContent += msg + "\n"; }
    $("year").textContent = new Date().getFullYear();

    // Load files
    $("videoFiles").onchange = (e)=>{
      clipList = [...e.target.files].map(f=>({file:f, name:f.name, in:null, out:null, dur:null}));
      renderClipRows();
    };
    $("audioFile").onchange = (e)=> audioBlob = e.target.files[0] || null;

    function renderClipRows(){
      const clipsDiv = $("clips");
      clipsDiv.innerHTML = "";
      clipList.forEach((c,idx)=>{
        const wrap = document.createElement("div");
        wrap.className = "stack";
        wrap.style.border = "1px solid #1f2433"; wrap.style.borderRadius = "10px"; wrap.style.padding = "8px";
        wrap.innerHTML = `
          <div class="row" style="font-size:.9rem"><strong>${idx+1}.</strong> <span>${c.name}</span> <span class="muted">duration: ${c.dur ?? "?"}s</span></div>
          <div class="row">
            <label>In (s)<input data-k="in" data-i="${idx}" type="number" step="0.1" value="${c.in ?? ""}"></label>
            <label>Out (s)<input data-k="out" data-i="${idx}" type="number" step="0.1" value="${c.out ?? ""}"></label>
          </div>`;
        clipsDiv.appendChild(wrap);
      });
      clipsDiv.querySelectorAll("input[data-k]").forEach(inp=>{
        inp.oninput = (e)=>{
          const i = +e.target.dataset.i, k = e.target.dataset.k;
          const v = e.target.value === "" ? null : parseFloat(e.target.value);
          clipList[i][k] = v;
        };
      });
    }

    $("scanClips").onclick = async ()=>{
      if (!clipList.length) return;
      for (const c of clipList){ c.dur = await getDuration(c.file); }
      renderClipRows();
    };

    function getDuration(file){
      return new Promise(res=>{
        const v = document.createElement("video");
        v.preload="metadata";
        v.onloadedmetadata = ()=> res(parseFloat(v.duration.toFixed(3)));
        v.src = URL.createObjectURL(file);
      });
    }

    $("addSplit").onclick = ()=> alert("Tip: to split a clip, add the same file twice and set different in/out.");

    $("preview").onclick = async ()=>{
      if (!clipList.length) return;
      const url = await buildMerged("preview.webm", {format:"webm", preview:true});
      $("player").src = url;
    };
    $("thumbs").onclick = async ()=>{
      if (!clipList.length) return;
      const url = await buildMerged("thumbsrc.webm", {format:"webm", preview:true});
      makeThumbs(url);
    };
    $("export").onclick = async ()=>{
      if (!clipList.length) return;
      const fmt = $("format").value;
      const fname = `export_${Date.now()}.${fmt}`;
      const url = await buildMerged(fname, {format:fmt, preview:false});
      const a = document.createElement("a");
      a.href = url; a.download = fname; a.click();
    };

    async function ensureFF(){
      if (ffmpeg) return;
      ffmpeg = createFFmpeg({ log:true, corePath: "https://unpkg.com/@ffmpeg/core@0.12.8/dist/ffmpeg-core.js" });
      await ffmpeg.load();
      log("FFmpeg loaded.");
    }

    function parseWH(){
      const p = $("preset").value;
      if (p==="orig") return null;
      const [w,h] = p.split("x").map(n=>parseInt(n,10));
      return {w,h};
    }

    async function buildMerged(outName, {format, preview}){
      await ensureFF();

      // Write inputs
      for (let i=0;i<clipList.length;i++){
        await ffmpeg.FS("writeFile", `v${i}.mp4`, await fetchFile(clipList[i].file));
      }
      if (audioBlob){ await ffmpeg.FS("writeFile", `music`, await fetchFile(audioBlob)); }

      const fps = parseInt($("fps").value,10);
      const wh = parseWH();
      const scalePad = wh
        ? `scale=${wh.w}:${wh.h}:force_original_aspect_ratio=decrease,pad=${wh.w}:${wh.h}:(ow-iw)/2:(oh-ih)/2`
        : "scale=trunc(iw/2)*2:trunc(ih/2)*2"; // ensure even dims

      const filterGraph = [];
      // Trim each clip
      for (let i=0;i<clipList.length;i++){
        const c = clipList[i];
        const tIn = (c.in ?? 0);
        const tOut = (c.out ?? (c.dur ?? 1e9));
        filterGraph.push(
          `[${i}:v]trim=${tIn}:${tOut},setpts=PTS-STARTPTS,${scalePad},fps=${fps}[v${i}t]`,
          `[${i}:a]atrim=${tIn}:${tOut},asetpts=PTS-STARTPTS[a${i}t]`
        );
      }
      // Concat
      filterGraph.push(`${Array.from({length:clipList.length},(_,i)=>`[v${i}t]`).join("")}concat=n=${clipList.length}:v=1:a=0[vcat]`);
      filterGraph.push(`${Array.from({length:clipList.length},(_,i)=>`[a${i}t]`).join("")}concat=n=${clipList.length}:v=0:a=1[acat]`);

      // Text overlay
      let vmap = "[vcat]";
      const txt = $("txt").value.trim();
      if (txt){
        const pos = $("txtPos").value;
        let x="(w-text_w)/2", y="(h-text_h)/2";
        if (pos==="top"){ y="50"; }
        if (pos==="bottom"){ y="h-text_h-50"; }
        if (pos==="custom"){ x=$("txtX").value||"40"; y=$("txtY").value||"60"; }
        const enable = `between(t\\,${$("txtStart").value||0}\\,${$("txtEnd").value||5})`;
        const fontopt = $("fontFile").files[0] ? ":fontfile='userfont.ttf'" : "";
        if ($("fontFile").files[0]){
          await ffmpeg.FS("writeFile", "userfont.ttf", await fetchFile($("fontFile").files[0]));
        }
        const safeText = txt.replace(/:/g,"\\:").replace(/'/g,"\\'");
        filterGraph.push(`[vcat]drawtext=text='${safeText}':fontsize=${$("txtSize").value||64}:fontcolor=white:borderw=2:x=${x}:y=${y}:enable='${enable}'${fontopt}[vtx]`);
        vmap = "[vtx]";
      }

      // Music / audio mode
      let amap = "[acat]";
      const hasMusic = !!audioBlob;
      if (hasMusic){
        const last = clipList.length; // music input index
        const mode = $("audioMode").value;
        if (mode==="replace"){ filterGraph.push(`[${last}:a]anull[amusic]`); amap = "[amusic]"; }
        else if (mode==="mix"){ filterGraph.push(`[acat][${last}:a]amix=inputs=2:dropout_transition=2[amix]`); amap = "[amix]"; }
        else if (mode==="crossfade"){ filterGraph.push(`[${last}:a]afade=t=in:ss=0:d=1,afade=t=out:st=10:d=1[amusicf]`, `[acat][amusicf]amix=inputs=2:dropout_transition=2[amix]`); amap = "[amix]"; }
      }

      // Build args
      const inputs = [];
      for (let i=0;i<clipList.length;i++){ inputs.push("-i", `v${i}.mp4`); }
      if (hasMusic) inputs.push("-i","music");

      const args = [
        ...inputs,
        "-filter_complex", filterGraph.join(";"),
        "-map", vmap,
        "-map", amap,
        "-r", String(fps)
      ];

      if (format==="mp4"){
        args.push("-c:v","libx264","-pix_fmt","yuv420p","-c:a","aac","-b:a","192k","-movflags","+faststart", outName);
      } else {
        args.push("-c:v","libvpx-vp9","-b:v","0","-crf","32","-c:a","libopus","-b:a","128k", outName);
      }

      log("Rendering‚Ä¶ this can take a while for long clips.");
      await ffmpeg.run(...args);
      const data = ffmpeg.FS("readFile", outName);
      const blob = new Blob([data.buffer], { type: (format==="mp4"?"video/mp4":"video/webm") });
      const url = URL.createObjectURL(blob);
      if (preview) $("player").src = url;
      log(`Done: ${outName} (${(data.length/1e6).toFixed(2)} MB)`);
      return url;
    }

    async function makeThumbs(videoUrl){
      const v = document.createElement("video");
      v.src = videoUrl; v.muted = true;
      await v.play().catch(()=>{});
      const canvas = document.createElement("canvas");
      canvas.width = 320; canvas.height = 180;
      const ctx = canvas.getContext("2d");
      $("thumbRow").innerHTML = "";
      const points = [0,1,2,3,4];
      for (const p of points){
        v.currentTime = p * 2;
        await new Promise(r=> v.onseeked = ()=> r());
        ctx.drawImage(v,0,0,canvas.width,canvas.height);
        const img = new Image();
        img.src = canvas.toDataURL("image/jpeg", .8);
        img.style.width="160px"; img.style.borderRadius="8px";
        $("thumbRow").appendChild(img);
      }
      v.pause();
    }
  </script>
</body>
</html>
